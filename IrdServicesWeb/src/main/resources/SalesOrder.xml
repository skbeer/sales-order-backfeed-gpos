<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL MAP 2.0//EN"     "http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="SalesOrder">
    <typeAlias alias="pposOrder"
               type="com.monsanto.irdsoapservices.salesorder.domain.PPOSOrderInfo"/>
    <typeAlias alias="cosOrder"
               type="com.monsanto.irdsoapservices.salesorder.domain.COSOrderInfo"/>
    <typeAlias alias="gposOrder"
               type="com.monsanto.irdsoapservices.salesorder.domain.GPOSOrderInfo"/>

    <resultMap id="ppos" class="pposOrder">
        <result property="crmOrderNumber" column="CRM_OBJ_ID"/>
        <result property="orderNumber" column="ORDER_ID"/>
        <result property="orderType" column="SALES_ORDER_TYPE_CODE"/>
        <result property="orderFiscalYear" column="FISCAL_YEAR"/>
        <result property="orderDate" column="ORDER_DATE"/>
        <result property="dealerInfo.acctId" column="DEALER_ACCT_ID"/>
        <result property="dealerInfo.ebid" column="DEALER_EBID"/>
        <result property="dealerInfo.partnerName" column="DEALER_NAME"/>
        <result property="dealerInfo.address" column="DEALER_MAILING_ADDRESS"/>
        <result property="dealerInfo.city" column="DEALER_MAILING_CITY"/>
        <result property="dealerInfo.state" column="DEALER_MAILING_STATE"/>
        <result property="dealerInfo.zip" column="DEALER_MAILING_ZIP_CODE"/>
        <result property="dealerInfo.county" column="DEALER_MAILING_COUNTY"/>
        <result property="growerInfo.acctId" column="GROWER_ACCT_ID"/>
        <result property="growerInfo.gln" column="GROWER_GLN"/>
        <result property="growerInfo.napd" column="GROWER_NAPD_ID"/>
        <result property="growerInfo.partnerName" column="GROWER_NAME"/>
        <result property="growerInfo.contactName" column="GROWER_CONTACT_NAME"/>
        <result property="growerInfo.address" column="GROWER_MAILING_ADDRESS"/>
        <result property="growerInfo.city" column="GROWER_MAILING_CITY"/>
        <result property="growerInfo.state" column="GROWER_MAILING_STATE"/>
        <result property="growerInfo.zip" column="GROWER_MAILING_ZIP_CODE"/>
        <result property="growerInfo.county" column="GROWER_MAILING_COUNTY"/>
        <result property="tempLineItem.itemNumber" column="ORDER_ITEM_ID"/>
        <result property="tempLineItem.productUpc" column="UPC_CODE"/>
        <result property="tempLineItem.productGtin" column="GTIN"/>
        <result property="tempLineItem.productName" column="PRODUCT_NAME"/>
        <result property="tempLineItem.salesQuantity.qtyValue" column="SALES_QTY"/>
        <result property="tempLineItem.salesQuantity.qtyUom" column="SALES_UOM"/>
        <result property="tempLineItem.equivalentQuantity.qtyValue" column="EQUIVILENT_QTY"/>
        <result property="tempLineItem.equivalentQuantity.qtyUom" column="EQUIVILENT_QTY_UOM"/>
        <result property="tempLineItem.salesRep.partnerName" column="SALESREP_NAME"/>
        <result property="tempLineItem.salesRep.buyerId" column="SALESREP_ID"/>
        <result property="tempLineItem.salesRep.address" column="SALESREP_ADDRESS_1"/>
        <result property="tempLineItem.salesRep.address2" column="SALESREP_ADDRESS_2"/>
        <result property="tempLineItem.salesRep.city" column="SALESREP_CITY"/>
        <result property="tempLineItem.salesRep.state" column="SALESREP_STATE"/>
        <result property="tempLineItem.salesRep.zip" column="SALESREP_ZIP"/>
    </resultMap>

    <resultMap id="cos" class="cosOrder">
        <result property="dealerInfo.ebid" column="DEALER_EBID"/>
        <result property="dealerInfo.acctId" column="DEALER_ACCT_ID"/>
        <result property="dealerInfo.partnerName" column="DEALER_NAME"/>
        <result property="dealerInfo.address" column="DEALER_ADDRESS"/>
        <result property="dealerInfo.address2" column="DEALER_ADDRESS2"/>
        <result property="dealerInfo.city" column="DEALER_CITY"/>
        <result property="dealerInfo.state" column="DEALER_STATE"/>
        <result property="dealerInfo.zip" column="DEALER_ZIP"/>
        <result property="dealerInfo.county" column="DEALER_COUNTY"/>
        <result property="tempLineItem.productName" column="PRODUCT_NAME"/>
        <result property="tempLineItem.productGtin" column="GTIN"/>
        <result property="tempLineItem.productName" column="PRODUCT_NAME"/>
        <result property="tempLineItem.orderQty" column="ORDER_QTY"/>
        <result property="tempLineItem.shippedQty" column="SHIPPED_QTY"/>
        <result property="tempLineItem.pendingQty" column="PENDING_QTY"/>
        <result property="orderNumber" column="ACCT_ID_CROP_YEAR"/>
    </resultMap>

    <resultMap id="gpos" class="gposOrder">
        <result property="orderNumber" column="INVC_ID"/>
        <result property="orderType" column="SALES_ORDER_TYPE_CODE"/>
        <result property="orderFiscalYear" column="FISCAL_YEAR"/>
        <result property="orderDate" column="INVC_DATE"/>
        <result property="dealerInfo.acctId" column="DEALER_ACCT_ID"/>
        <result property="dealerInfo.ebid" column="DEALER_EBID"/>
        <result property="dealerInfo.partnerName" column="DEALER_NAME"/>
        <result property="dealerInfo.address" column="DEALER_MAILING_ADDRESS"/>
        <result property="dealerInfo.city" column="DEALER_MAILING_CITY"/>
        <result property="dealerInfo.state" column="DEALER_MAILING_STATE"/>
        <result property="dealerInfo.zip" column="DEALER_MAILING_ZIP_CODE"/>
        <result property="dealerInfo.county" column="DEALER_MAILING_COUNTY"/>
        <result property="growerInfo.acctId" column="GROWER_ACCT_ID"/>
        <result property="growerInfo.gln" column="GROWER_GLN"/>
        <result property="growerInfo.napd" column="GROWER_NAPD_ID"/>
        <result property="growerInfo.partnerName" column="GROWER_NAME"/>
        <result property="growerInfo.contactName" column="GROWER_CONTACT_NAME"/>
        <result property="growerInfo.address" column="GROWER_MAILING_ADDRESS"/>
        <result property="growerInfo.city" column="GROWER_MAILING_CITY"/>
        <result property="growerInfo.state" column="GROWER_MAILING_STATE"/>
        <result property="growerInfo.zip" column="GROWER_MAILING_ZIP_CODE"/>
        <result property="growerInfo.county" column="GROWER_MAILING_COUNTY"/>
        <result property="tempLineItem.itemNumber" column="INVC_ITEM_ID"/>
        <result property="tempLineItem.productUpc" column="UPC_CODE"/>
        <result property="tempLineItem.productGtin" column="GTIN"/>
        <result property="tempLineItem.productName" column="PRODUCT_NAME"/>
        <result property="tempLineItem.salesQuantity.qtyValue" column="SALES_QTY"/>
        <result property="tempLineItem.salesQuantity.qtyUom" column="SALES_UOM"/>
        <result property="tempLineItem.equivalentQuantity.qtyValue" column="EQUIVALENT_QTY"/>
        <result property="tempLineItem.equivalentQuantity.qtyUom" column="EQUIVILENT_QTY_UOM"/>
        <result property="tempLineItem.salesRep.partnerName" column="SALESREP_NAME"/>
        <result property="tempLineItem.salesRep.contactName" column="CONTACT_NAME"/>
        <result property="tempLineItem.salesRep.buyerId" column="SALESREP_ID"/>
        <result property="tempLineItem.salesRep.address" column="SALESREP_ADDRESS_1"/>
        <result property="tempLineItem.salesRep.city" column="SALESREP_CITY"/>
        <result property="tempLineItem.salesRep.state" column="SALESREP_STATE"/>
        <result property="tempLineItem.salesRep.zip" column="SALESREP_ZIP"/>
        <result property="tempLineItem.salesRep.county" column="SALESREP_COUNTY"/>
    </resultMap>

    <resultMap id="gposWinfield" class="gposOrder">
        <result property="orderNumber" column="RPTD_DOC_NBR"/>
        <result property="orderType" column="SALES_ORDER_TYPE_CODE"/>
        <result property="orderFiscalYear" column="FISCAL_YEAR"/>
        <result property="orderDate" column="INVC_DATE"/>
        <result property="dealerInfo.acctId" column="DEALER_ACCT_ID"/>
        <result property="dealerInfo.ebid" column="DEALER_EBID"/>
        <result property="dealerInfo.partnerName" column="DEALER_NAME"/>
        <result property="dealerInfo.address" column="DEALER_MAILING_ADDRESS"/>
        <result property="dealerInfo.city" column="DEALER_MAILING_CITY"/>
        <result property="dealerInfo.state" column="DEALER_MAILING_STATE"/>
        <result property="dealerInfo.zip" column="DEALER_MAILING_ZIP_CODE"/>
        <result property="dealerInfo.county" column="DEALER_MAILING_COUNTY"/>
        <result property="growerInfo.acctId" column="GROWER_ACCT_ID"/>
        <result property="growerInfo.gln" column="GROWER_GLN"/>
        <result property="growerInfo.partnerName" column="GROWER_NAME"/>
        <result property="growerInfo.contactName" column="GROWER_CONTACT_NAME"/>
        <result property="growerInfo.address" column="GROWER_MAILING_ADDRESS"/>
        <result property="growerInfo.city" column="GROWER_MAILING_CITY"/>
        <result property="growerInfo.state" column="GROWER_MAILING_STATE"/>
        <result property="growerInfo.zip" column="GROWER_MAILING_ZIP_CODE"/>
        <result property="growerInfo.county" column="GROWER_MAILING_COUNTY"/>
        <result property="tempLineItem.productUpc" column="UPC_CODE"/>
        <result property="tempLineItem.productGtin" column="GTIN"/>
        <result property="tempLineItem.productName" column="PRODUCT_NAME"/>
        <result property="tempLineItem.salesQuantity.qtyValue" column="SALES_QTY"/>
        <result property="tempLineItem.salesQuantity.qtyUom" column="SALES_UOM"/>
        <result property="tempLineItem.equivalentQuantity.qtyValue" column="EQUIVALENT_QTY"/>
        <result property="tempLineItem.equivalentQuantity.qtyUom" column="EQUIVILENT_QTY_UOM"/>
        <result property="salesRepWinfield.partnerName" column="SALESREP_NAME"/>
        <result property="salesRepWinfield.contactName" column="CONTACT_NAME"/>
        <result property="salesRepWinfield.buyerId" column="SALESREP_ID"/>
        <result property="salesRepWinfield.address" column="SALESREP_ADDRESS_1"/>
        <result property="salesRepWinfield.city" column="SALESREP_CITY"/>
        <result property="salesRepWinfield.state" column="SALESREP_STATE"/>
        <result property="salesRepWinfield.zip" column="SALESREP_ZIP"/>
        <result property="salesRepWinfield.county" column="SALESREP_COUNTY"/>
        <result property="tempLineItem.orderTransactionType" column="Touched_Untouched"/>
    </resultMap>

    <resultMap id="gposWinfieldAgdata" class="gposOrder">
        <result property="orderNumber" column="RPTD_DOC_NBR"/>
        <result property="orderType" column="SALES_ORDER_TYPE_CODE"/>
        <result property="orderFiscalYear" column="FISCAL_YEAR"/>
        <result property="orderDate" column="INVC_DATE"/>
        <result property="dealerInfo.acctId" column="DEALER_ACCT_ID"/>
        <result property="dealerInfo.ebid" column="DEALER_EBID"/>
        <result property="dealerInfo.partnerName" column="DEALER_NAME"/>
        <result property="dealerInfo.address" column="DEALER_MAILING_ADDRESS"/>
        <result property="dealerInfo.city" column="DEALER_MAILING_CITY"/>
        <result property="dealerInfo.state" column="DEALER_MAILING_STATE"/>
        <result property="dealerInfo.zip" column="DEALER_MAILING_ZIP_CODE"/>
        <result property="dealerInfo.county" column="DEALER_MAILING_COUNTY"/>
        <result property="growerInfo.acctId" column="GROWER_ACCT_ID"/>
<!--        <result property="growerInfo.gln" column="GROWER_GLN"/>-->
        <result property="growerInfo.napd" column="GROWER_NAPD_ID"/>
        <result property="growerInfo.partnerName" column="GROWER_NAME"/>
        <result property="growerInfo.contactName" column="GROWER_CONTACT_NAME"/>
        <result property="growerInfo.address" column="GROWER_MAILING_ADDRESS"/>
        <result property="growerInfo.city" column="GROWER_MAILING_CITY"/>
        <result property="growerInfo.state" column="GROWER_MAILING_STATE"/>
        <result property="growerInfo.zip" column="GROWER_MAILING_ZIP_CODE"/>
        <result property="growerInfo.county" column="GROWER_MAILING_COUNTY"/>
        <result property="tempLineItem.productUpc" column="UPC_CODE"/>
        <result property="tempLineItem.productGtin" column="GTIN"/>
        <result property="tempLineItem.productName" column="PRODUCT_NAME"/>
        <result property="tempLineItem.productNum" column="SAP_MAT_ID"/>
<!--        <result property="tempLineItem.acronymName" column="ACRONYM_NAME"/>-->
        <result property="tempLineItem.lineIdentifier" column="TRAN_ID"/>
        <result property="tempLineItem.salesQuantity.qtyValue" column="SALES_QTY"/>
        <result property="tempLineItem.salesQuantity.qtyUom" column="SALES_UOM"/>
        <result property="tempLineItem.equivalentQuantity.qtyValue" column="EQUIVALENT_QTY"/>
        <result property="tempLineItem.equivalentQuantity.qtyUom" column="EQUIVILENT_QTY_UOM"/>
        <result property="salesRepWinfield.partnerName" column="SALESREP_NAME"/>
        <result property="salesRepWinfield.contactName" column="CONTACT_NAME"/>
        <result property="salesRepWinfield.buyerId" column="SALESREP_ID"/>
        <result property="salesRepWinfield.address" column="SALESREP_ADDRESS_1"/>
        <result property="salesRepWinfield.city" column="SALESREP_CITY"/>
        <result property="salesRepWinfield.state" column="SALESREP_STATE"/>
        <result property="salesRepWinfield.zip" column="SALESREP_ZIP"/>
        <result property="salesRepWinfield.county" column="SALESREP_COUNTY"/>
        <result property="tempLineItem.orderTransactionType" column="Touched_Untouched"/>
<!--        <result property="dealerInfo.techId" column="MDM_TECH_ID"/>-->
<!--        <result property="growerInfo.techId" column="MDM_TECH_ID"/>-->
        <result property="tempLineItem.specie_descr" column="SPECIE_DESCR"/>
        <result property="tempLineItem.seed_co_brand_descr" column="SEED_CO_BRAND_DESCR"/>
    </resultMap>

    <resultMap id="gposWinfieldAgdata2021" class="gposOrder">
        <result property="orderNumber" column="RPTD_DOC_NBR"/>
        <result property="orderType" column="SALES_ORDER_TYPE_CODE"/>
        <result property="orderFiscalYear" column="FISCAL_YEAR"/>
        <result property="orderDate" column="INVC_DATE"/>
        <result property="dealerInfo.acctId" column="DEALER_ACCT_ID"/>
        <result property="dealerInfo.ebid" column="DEALER_EBID"/>
        <result property="dealerInfo.partnerName" column="DEALER_NAME"/>
        <result property="dealerInfo.address" column="DEALER_MAILING_ADDRESS"/>
        <result property="dealerInfo.city" column="DEALER_MAILING_CITY"/>
        <result property="dealerInfo.state" column="DEALER_MAILING_STATE"/>
        <result property="dealerInfo.zip" column="DEALER_MAILING_ZIP_CODE"/>
        <result property="dealerInfo.county" column="DEALER_MAILING_COUNTY"/>
        <result property="growerInfo.acctId" column="GROWER_ACCT_ID"/>
<!--        <result property="growerInfo.gln" column="GROWER_GLN"/>-->
        <result property="growerInfo.napd" column="GROWER_NAPD_ID"/>
        <result property="growerInfo.partnerName" column="GROWER_NAME"/>
        <result property="growerInfo.contactName" column="GROWER_CONTACT_NAME"/>
        <result property="growerInfo.address" column="GROWER_MAILING_ADDRESS"/>
        <result property="growerInfo.city" column="GROWER_MAILING_CITY"/>
        <result property="growerInfo.state" column="GROWER_MAILING_STATE"/>
        <result property="growerInfo.zip" column="GROWER_MAILING_ZIP_CODE"/>
        <result property="growerInfo.county" column="GROWER_MAILING_COUNTY"/>
        <result property="tempLineItem.productUpc" column="UPC_CODE"/>
        <result property="tempLineItem.productGtin" column="GTIN"/>
        <result property="tempLineItem.productName" column="PRODUCT_NAME"/>
        <result property="tempLineItem.productNum" column="SAP_MAT_ID"/>
<!--        <result property="tempLineItem.acronymName" column="ACRONYM_NAME"/>-->
        <result property="tempLineItem.lineIdentifier" column="TRAN_ID"/>
        <result property="tempLineItem.salesQuantity.qtyValue" column="SALES_QTY"/>
        <result property="tempLineItem.salesQuantity.qtyUom" column="SALES_UOM"/>
        <result property="tempLineItem.equivalentQuantity.qtyValue" column="EQUIVALENT_QTY"/>
        <result property="tempLineItem.equivalentQuantity.qtyUom" column="EQUIVILENT_QTY_UOM"/>
        <result property="salesRepWinfield.partnerName" column="SALESREP_NAME"/>
        <result property="salesRepWinfield.contactName" column="CONTACT_NAME"/>
        <result property="salesRepWinfield.buyerId" column="SALESREP_ID"/>
        <result property="salesRepWinfield.address" column="SALESREP_ADDRESS_1"/>
        <result property="salesRepWinfield.city" column="SALESREP_CITY"/>
        <result property="salesRepWinfield.state" column="SALESREP_STATE"/>
        <result property="salesRepWinfield.zip" column="SALESREP_ZIP"/>
        <result property="salesRepWinfield.county" column="SALESREP_COUNTY"/>
        <result property="tempLineItem.orderTransactionType" column="Touched_Untouched"/>
<!--        <result property="dealerInfo.techId" column="MDM_TECH_ID"/>-->
<!--        <result property="growerInfo.techId" column="MDM_TECH_ID"/>-->
        <result property="tempLineItem.specie_descr" column="SPECIE_DESCR"/>
        <result property="tempLineItem.seed_co_brand_descr" column="SEED_CO_BRAND_DESCR"/>
    </resultMap>
    <!-- CUSTPLT - 651 , LEPSI IRD For B2B. In each query, cdw/cdw_dm/cdw_dm_share schemas are replaced with d1_ms schema-->
    <select id="getPPOSOrders" resultMap="ppos" parameterClass="java.util.Map">
        SELECT
        psgo.order_id || ' ' ||
        psgo.order_item_id crm_obj_id,
        psgo.order_id,
        psgo.order_item_id,
        'RT' sales_order_type_code,
        dd.day_date order_date,
        SUBSTR (dd.fy, 1, 4) fiscal_year,
        cad.name_1 dealer_name,
        cad.ic_code dealer_ebid,
        cad.acct_id dealer_acct_id,
        cad.mailing_addr_line_1 dealer_mailing_address,
        cad.mailing_city dealer_mailing_city,
        cad.mailing_state_code dealer_mailing_state,
        cad.mailing_zip_code dealer_mailing_zip_code,
        cad.mailing_county dealer_mailing_county,
        gd.name_1 grower_name,
        gd.gln grower_gln,
        gd.napd_id grower_napd_id,
        gd.acct_id grower_acct_id,
        ACM.CONTACT_FIRST_NAME||' '||ACM.CONTACT_LAST_NAME GROWER_CONTACT_NAME,
        gd.mailing_addr_line_1 grower_mailing_address,
        gd.mailing_city grower_mailing_city,
        gd.mailing_state_code grower_mailing_state,
        gd.mailing_zip_code grower_mailing_zip_code,
        gd.mailing_county grower_mailing_county,
        spd.upc_code,
        spd.legal_descr_1 product_name,
        pps.upc_scc_code gtin,
        psgo.os_order_ssu_qty/psgo.base_to_ssu_uom_conv_fctr sales_qty,
        decode (ud.uom_code,'LB','LBR', ud.uom_code) sales_uom,
        psgo.os_order_ssu_qty equivilent_qty,
        'UN' equivilent_qty_uom,
        ss.name_1 || ' ' || ss.name_3 salesrep_name,
        ss.alias_ss_code salesrep_id,
        ss.addr_line_1 salesrep_address_1,
        ss.addr_line_2 salesrep_address_2,
        ss.city salesrep_city,
        ss.state_code salesrep_state,
        ss.zip_code salesrep_zip
        FROM d1_OS_SALES_ORDER_ITEM_AS psgo,
        d1_seed_product_dim spd,
        d1_channel_account_dim cad,
        d1_grower_dim gd,
        s_acct_sales_area cgp,
        d1_date_dim dd,
        d1_unit_of_measure_dim ud,
        s_seedco_salesrep_to_acct ssa,
        s_seedco_salesrep ss,
        s_prod_package_struct pps,
        s_acct_contact_mailing_dnml acm,
        (SELECT DISTINCT
        dest_alias_id cust_grp_code, source_alias_id cust_grp_name
        FROM d1_biotech_translation
        WHERE 'CDW749RT' = alias_program
        AND #groupCode# = dest_alias_id
        AND 'CustGrp' = source_alias_type) sc
        WHERE
        ((psgo.product_key = spd.product_key)
        or
        (spd.SAP_MATERIAL_ID = psgo.product_key))
        AND psgo.ship_to_acct_key = cad.acct_key
        AND psgo.sold_to_acct_key = gd.grower_key
        AND psgo.order_entry_date_key = dd.date_key
        AND psgo.base_uom_key = ud.uom_key
        AND pps.prod_id = spd.product_id
        AND cgp.acct_id = cad.acct_id(+)
        AND cgp.customer_grp_code = sc.cust_grp_code
        AND cad.acct_id = ssa.acct_id(+)
        AND ssa.seedco_salesrep_id = ss.seedco_salesrep_id(+)
        AND NVL (cgp.mfd_flag, 'N') != 'X'
        AND cgp.distribution_channel_code = '02'
        AND cgp.division_code = '17'
        AND cgp.sales_org_code = 'CJ20'
        AND
        cast(substr(gd.primary_contact_id,-7) as int) = acm.contact_id(+)
        AND dd.curr_fy_offset = 0
        order by  order_item_id
    </select>

    <select id="getCOSOrders" resultMap="cos" parameterClass="java.util.Map">

        SELECT
        cad.name_1 dealer_name,
        cad.ic_code dealer_ebid,
        cad.acct_id dealer_acct_id,
        cad.mailing_addr_line_1 dealer_address,
        cad.mailing_addr_line_2 dealer_address2,
        cad.mailing_city dealer_city,
        cad.mailing_county dealer_county,
        cad.mailing_state_code dealer_state,
        cad.mailing_zip_code dealer_zip,
        spd.legal_descr_1 product_name,
        pps.upc_scc_code gtin,
        cad.acct_id||dd.mkt_yr acct_id_crop_year,
        sum(ocf.os_requested_qty) order_qty,
        sum(ocf.os_shipped_qty) shipped_qty,
        sum(ocf.os_requested_qty - ocf.os_shipped_qty) pending_qty,
        sum(ocf.os_open_request_qty) remaining_qty
        FROM D1_OS_CHANNEL_FULFILLMENT ocf,
        d1_channel_account_dim cad,
        d1_date_dim dd,
        s_acct_sales_area cgp,
        s_prod_package_struct pps,
        d1_seed_product_dim spd
        WHERE cad.acct_key = ocf.rtlr_acct_key
        AND dd.date_key = ocf.eff_date_key
        AND dd.curr_fy_offset = 0
        AND cgp.customer_grp_code = #groupCode#
        AND dd.day_date > #startDate#
        AND cgp.acct_id = cad.acct_id
        AND pps.prod_id = spd.product_id
        AND ((spd.product_key = ocf.product_key)
        or
        (spd.SAP_MATERIAL_ID = ocf.product_key))
        AND spd.product_class_id != 'N'
        AND cgp.sales_org_code='CJ20'
        AND cgp.distribution_channel_code='02'
        AND cgp.division_code=17
        GROUP BY
        cad.name_1,
        cad.ic_code,
        cad.acct_id,
        cad.mailing_addr_line_1,
        cad.mailing_addr_line_2,
        cad.mailing_city,
        cad.mailing_county,
        cad.mailing_state_code,
        cad.mailing_zip_code,
        spd.legal_descr_1,
        pps.upc_scc_code,
        cad.acct_id||dd.mkt_yr
        ORDER BY cad.acct_id
    </select>

    <select id="getGPOSOrders" resultMap="gpos" parameterClass="java.util.Map">
        SELECT
        rpt_sales.invc_id invc_id,
        rpt_sales.invc_item_id invc_item_id,
        'NS' sales_order_type_code,
        dd.day_date invc_date,
        SUBSTR(rpt_sales.market_year,1,4) fiscal_year,
        cad.name_1 dealer_name,
        cad.ic_code dealer_ebid,
        cad.acct_id dealer_acct_id,
        cad.shipping_addr_line_1 dealer_mailing_address,
        cad.shipping_city dealer_mailing_city,
        cad.shipping_state_code dealer_mailing_state,
        cad.shipping_zip_code dealer_mailing_zip_code,
        cad.shipping_county dealer_mailing_county,
        g.name_1 grower_name,
        gln_map.alias_id grower_gln,
        g.napd_id grower_napd_id,
        g.acct_id grower_acct_id,
        g.primary_contact_full_name grower_contact_name,
        g.mailing_addr_line_1 grower_mailing_address,
        g.mailing_city grower_mailing_city,
        g.mailing_state_code grower_mailing_state,
        g.mailing_zip_code grower_mailing_zip_code,
        g.mailing_county grower_mailing_county,
        rpt_sales.upc_code upc_code,
        rpt_sales.upc_legal_descr product_name,
        rpt_sales.gtin_id gtin,
        SUM(delivered_sales_qty) sales_qty,
        DECODE(rpt_sales.SALES_UOM, 'BN','BG',rpt_sales.SALES_UOM) sales_uom,
        SUM(delivered_ssu_qty) equivalent_qty,
        'UN' equivilent_qty_uom,
        cad.name_1 salesrep_name,
        salesrep.name_1
        || ' '
        || salesrep.name_3 contact_name,
        salesrep.alias_ss_code salesrep_id,
        cad.mailing_addr_line_1 salesrep_address_1,
        cad.mailing_city salesrep_city,
        cad.mailing_state_code salesrep_state,
        cad.mailing_zip_code salesrep_zip,
        cad.mailing_county salesrep_county
        FROM
        d1_active_grower_dim g,
        d1_active_channel_account_dim cad,
        s_acct_sales_area cgp,
        (
        SELECT
        *
        FROM
        (
        SELECT
        acct_id,
        system_type_code,
        alias_id,
        active_flag,
        rank,
        begin_date,
        MAX(begin_date) over (partition BY acct_id, rank) max_date
        FROM
        s_acct_xref
        WHERE
        system_type_code='GLN'
        AND active_flag   ='Y'
        AND rank          =1
        )
        WHERE
        begin_date = max_date
        )
        gln_map,
        d1_date_dim dd,
        (
        SELECT
        gec.ship_from_acct_key seller_acct_key,
        gec.ship_to_grower_key grower_key,
        gec.invc_date_key,
        gec.invc_id,
        NVL(gec.customer_line_item_nbr, gec.invc_item_id) invc_item_id,
        gec.product_key,
        spd.upc_code,
        spd.legal_descr_1 upc_legal_descr,
        gtin_map.gtin_id,
        ud.uom_code,
        gtin_map.sales_uom,
        SUBSTR (dpm.period_descr, 1, 4)
        || 'M' market_year,
        LPAD (NVL (gec.seedco_sales_rep_code, 0), 12, '0' ) rtl_sales_person_id,
        sc.cust_grp_code,
        SUM (
        CASE
        WHEN spd.specie_code IN ('L', 'F')
        THEN ROUND( DECODE( SPD.BASE_UOM_ID, 'AC',0, (DATA_CNV.RPT_EQU_QTY(
        SPD.SPECIE_CODE, ((gec.GPOS_SEED_BASE_QTY/ SPD.BASE_QTY)*
        SPD.BASE_TO_SSU_FACTOR), SPD.BASE_TO_SSU_FACTOR,
        SPD.GRADE_SIZE_CODE))),2)
        ELSE
        CASE
        WHEN s.use_ssu = 'Y'
        THEN ROUND( DECODE( SPD.BASE_UOM_ID, 'AC',0, (
        DATA_CNV.RPT_EQU_QTY( SPD.SPECIE_CODE, ((gec.GPOS_SEED_BASE_QTY
        / SPD.BASE_QTY)* SPD.BASE_TO_SSU_FACTOR),
        SPD.BASE_TO_SSU_FACTOR, SPD.GRADE_SIZE_CODE))),2)
        ELSE (ROUND( DECODE( SPD.BASE_UOM_ID, 'AC',0, (
        DATA_CNV.RPT_EQU_QTY( SPD.SPECIE_CODE, ((gec.GPOS_SEED_BASE_QTY
        / SPD.BASE_QTY)* SPD.BASE_TO_SSU_FACTOR),
        SPD.BASE_TO_SSU_FACTOR, SPD.GRADE_SIZE_CODE))),2) /
        spd.base_to_ssu_factor )
        END
        END ) delivered_sales_qty,
        SUM (ROUND( DECODE( SPD.BASE_UOM_ID, 'AC',0, (DATA_CNV.RPT_EQU_QTY(
        SPD.SPECIE_CODE, ((gec.GPOS_SEED_BASE_QTY/ SPD.BASE_QTY)*
        SPD.BASE_TO_SSU_FACTOR), SPD.BASE_TO_SSU_FACTOR, SPD.GRADE_SIZE_CODE))),2
        ) ) delivered_ssu_qty
        FROM
        d1_gpos_seed_dsi_invoice gec,
        (
        SELECT DISTINCT
        invc_id,
        ship_from_acct_key
        FROM
        d1_gpos_seed_dsi_invoice
        WHERE
        TO_CHAR(row_eff_date,'YYYY-MM-DD') > #startDate#
        )
        orders_by_date,
        d1_active_channel_account_dim cad,
        d1_seed_product_dim spd,
        s_prod s,
        d1_unit_of_measure_dim ud,
        (
        SELECT DISTINCT
        t_prod_dim.PRODUCT_KEY  AS PRODUCT_KEY,
        t_uom_dim.UOM_KEY       AS PKG_UOM_KEY,
        t_gtin_map.UPC_SCC_CODE AS GTIN_ID,
        t_gtin_map.UOM_CODE     AS SALES_UOM
        FROM
        s_prod_package_struct t_gtin_map,
        d1_seed_product_dim t_prod_dim,
        d1_unit_of_measure_dim t_uom_dim
        WHERE
        t_gtin_map.PROD_ID    = t_prod_dim.PRODUCT_ID
        AND t_gtin_map.UOM_CODE = t_uom_dim.UOM_CODE
        )
        gtin_map,
        d1_date_period_map dpm,
        (
        SELECT DISTINCT
        dest_alias_id cust_grp_code,
        source_alias_id cust_grp_name
        FROM
        d1_biotech_translation
        WHERE
        'CDW749RT'    = alias_program
        AND #groupCode# = dest_alias_id
        AND 'CustGrp'   = source_alias_type
        )
        sc,
        d1_data_source_dim ds
        WHERE
        gec.invc_id              = orders_by_date.invc_id
        AND gec.ship_from_acct_key = orders_by_date.ship_from_acct_key
        AND gec.ship_date_key      = dpm.date_key
        AND gec.product_key        = gtin_map.product_key(+)
        AND gec.base_uom_key       = ud.uom_key
        AND
        CASE
        WHEN spd.specie_code                 = 'L'
        AND SUBSTR (dpm.period_descr, 1, 4) >= '2006'
        AND SUBSTR (spd.trait_code, 1, 1)    = 'W'
        THEN 'WINTER CANOLA'
        ELSE 'MARKET YEAR'
        END = dpm.period_type
        AND
        CASE
        WHEN spd.specie_code                 = 'L'
        AND SUBSTR (dpm.period_descr, 1, 4) >= '2006'
        AND SUBSTR (spd.trait_code, 1, 1)    = 'W'
        THEN 0
        WHEN TO_NUMBER(TO_CHAR(SYSDATE, 'MM')) > 8
        THEN 1
        ELSE 0
        END                       = dpm.curr_period_offset
        AND gec.curr_flag           = 'Y'
        AND gec.func_code           = 'I'
        AND gec.del_flag            = 'N'
        AND spd.OWNED_LICENSED_CODE = 'OWNED'
        AND spd.product_key         = gec.product_key
        AND spd.product_id          = s.prod_id
        AND gec.data_src_key        = ds.data_src_key
        AND gec.rpt_acct_key        = cad.acct_key
        AND
        (
        ds.data_src_id IN ('SRX', 'SRXH', 'SRXF', 'SEEDTRAK','KEYED')
        OR
        (
        ds.data_src_id = 'WS-XML'
        AND cad.acct_id != 168618
        )
        )
        GROUP BY
        gec.ship_from_acct_key,
        gec.ship_to_grower_key,
        gec.invc_date_key,
        gec.invc_id,
        NVL(gec.customer_line_item_nbr, gec.invc_item_id),
        gec.product_key,
        spd.upc_code,
        spd.legal_descr_1,
        gtin_map.gtin_id,
        ud.uom_code,
        gtin_map.sales_uom,
        SUBSTR (dpm.period_descr, 1, 4),
        LPAD (NVL (gec.seedco_sales_rep_code, 0), 12, '0'),
        sc.cust_grp_code
        )
        rpt_sales,
        s_seedco_salesrep salesrep
        WHERE
        g.grower_key                                = rpt_sales.grower_key
        AND cad.acct_key                              = rpt_sales.seller_acct_key
        AND cad.acct_id                               = cgp.acct_id
        AND cgp.customer_grp_code                     = rpt_sales.cust_grp_code
        AND NVL (cgp.mfd_flag, 'N')                  != 'X'
        AND cgp.distribution_channel_code             = '02'
        AND cgp.division_code                         = '17'
        AND cgp.sales_org_code                        = 'CJ20'
        AND rpt_sales.invc_date_key                   = dd.date_key
        AND TO_NUMBER (rpt_sales.rtl_sales_person_id) = TO_NUMBER (
        salesrep.seedco_salesrep_id(+))
        AND rpt_sales.cust_grp_code = salesrep.customer_grp_code(+)
        AND
        (
        RTRIM(g.napd_id)         IS NOT NULL
        OR RTRIM(gln_map.alias_id) IS NOT NULL
        )
        AND g.acct_id                   = gln_map.acct_id(+)
        AND gln_map.system_type_code(+) = 'GLN'
        AND gln_map.rank(+)             = 1
        AND gln_map.active_flag(+)      = 'Y'
        GROUP BY
        SUBSTR(rpt_sales.market_year,1,4),
        cad.acct_id,
        cad.ic_code,
        cad.name_1,
        cad.shipping_addr_line_1,
        cad.shipping_city,
        cad.shipping_state_code,
        cad.shipping_zip_code,
        cad.shipping_county,
        g.acct_id,
        g.napd_id,
        g.primary_contact_full_name,
        g.name_1,
        g.mailing_addr_line_1,
        g.mailing_city,
        g.mailing_state_code,
        g.mailing_zip_code,
        g.mailing_county,
        gln_map.alias_id,
        rpt_sales.upc_code,
        rpt_sales.upc_legal_descr,
        rpt_sales.gtin_id,
        rpt_sales.uom_code,
        rpt_sales.sales_uom,
        rpt_sales.invc_id,
        rpt_sales.invc_item_id,
        dd.day_date,
        salesrep.alias_ss_code,
        salesrep.name_1,
        salesrep.name_3,
        cad.name_1,
        cad.mailing_addr_line_1,
        cad.mailing_city,
        cad.mailing_state_code,
        cad.mailing_zip_code,
        cad.mailing_county
        ORDER BY
        rpt_sales.invc_id,
        cad.acct_id
    </select>

    <select id="getGPOSDirectOrders" resultMap="gposWinfield" parameterClass="java.util.Map">
        SELECT
        rptd_doc_nbr,
        detail_seq_nbr,
        sales_order_type_code,
        data_source,
        invc_date,
        fiscal_year,
        dealer_name,
        dealer_ebid,
        dealer_acct_id,
        dealer_mailing_address,
        dealer_mailing_city,
        dealer_mailing_state,
        dealer_mailing_zip_code,
        dealer_mailing_county,
        grower_name,
        grower_gln,
        grower_acct_id,
        grower_contact_name,
        NVL (grower_mailing_address, 'NA') grower_mailing_address,
        NVL (grower_mailing_city, 'NA') grower_mailing_city,
        NVL (grower_mailing_state, 'NA') grower_mailing_state,
        NVL (grower_mailing_zip_code, 'NA') grower_mailing_zip_code,
        NVL (grower_mailing_county, 'NA') grower_mailing_county,
        upc_code,
        product_name,
        gtin,
        SUM (sales_qty) sales_qty,
        sales_uom,
        SUM (equivalent_qty) equivalent_qty,
        equivilent_qty_uom,
        'NA' AS salesrep_name,
        'NA' AS contact_name,
        'NA' AS salesrep_id,
        'NA' AS salesrep_address_1,
        'NA' AS salesrep_city,
        'NA' AS salesrep_state,
        'NA' AS salesrep_zip,
        'NA' AS salesrep_county,
        Touched_Untouched
        FROM (SELECT DISTINCT
        h.rptd_doc_nbr,
        h.tran_id,
        d.detail_seq_nbr,
        'NS' sales_order_type_code,
        ts.source data_source,
        dd.day_date invc_date,
        SUBSTR (dd.mkt_yr, 1, 4) fiscal_year,
        cad.name_1 dealer_name,
        cad.ic_code dealer_ebid,
        cad.acct_id dealer_acct_id,
        cad.shipping_addr_line_1 dealer_mailing_address,
        cad.shipping_city dealer_mailing_city,
        cad.shipping_state_code dealer_mailing_state,
        cad.shipping_zip_code dealer_mailing_zip_code,
        cad.shipping_county dealer_mailing_county,
        cbr.acct_name grower_name,
        gln_map.alias_id grower_gln,
        cbr.source_acct_id grower_acct_id,
        cbr.acct_name grower_contact_name,
        cbr.mailing_addr_line_1 grower_mailing_address,
        cbr.mailing_city grower_mailing_city,
        cbr.mailing_state_cd grower_mailing_state,
        cbr.mailing_postal_cd grower_mailing_zip_code,
        cbr.mailing_county grower_mailing_county,
        spd.upc_code upc_code,
        spd.legal_descr_1 product_name,
        pps.upc_scc_code gtin,
        DECODE (hs.status_id, '5', '0', d.ssu_qty) sales_qty,
        DECODE (pps.UOM_code, 'BN', 'BG', pps.UOM_code) sales_uom,
        DECODE (hs.status_id, '5', '0', d.ssu_qty) equivalent_qty,
        'UN' equivilent_qty_uom,
        cad.name_1 salesrep_name,
        salesrep.name_1 || ' ' || salesrep.name_3 contact_name,
        salesrep.alias_ss_code salesrep_id,
        cad.mailing_addr_line_1 salesrep_address_1,
        cad.mailing_city salesrep_city,
        cad.mailing_state_code salesrep_state,
        cad.mailing_zip_code salesrep_zip,
        cad.mailing_county salesrep_county,
        DECODE (h.man_attn_flag, 'Y', 'N', 'Y') Touched_Untouched
        FROM ecg_tran_header h,
        ecg_tran_detail d,
        ecg_tran_party p_sf,
        ecg_tran_party p_st,
        ecg_tran_party p_ds,
        ecg_tracking_source ts,
        ecg_tran_header_status hs,
        d1_active_channel_account_dim cad,
        d1_cbr_grower_dim cbr,
        s_acct_sales_area cgp,
        (SELECT *
        FROM (SELECT acct_id,
        system_type_code,
        alias_id,
        active_flag,
        RANK,
        begin_date,
        MAX (begin_date)
        OVER (PARTITION BY acct_id, RANK)
        max_date
        FROM s_acct_xref
        WHERE     system_type_code = 'GLN'
        AND active_flag = 'Y'
        AND RANK = 1)
        WHERE begin_date = max_date) gln_map,
        d1_date_dim dd,
        s_seedco_salesrep salesrep,
        d1_seed_product_dim spd,
        s_prod_package_struct pps,
        d1_date_period_map dpm,
        d1_biotech_translation bt
        WHERE     h.tran_id = d.tran_id
        AND h.tran_id = p_sf.tran_id
        AND p_sf.party_code = 'SF'
        AND h.tran_id = p_st.tran_id
        AND p_st.party_code = 'ST'
        AND h.tran_id = p_ds.tran_id
        AND p_ds.party_code = 'DS'
        AND h.tran_id = hs.tran_id
        AND hs.status_id IN (3, 5)
        AND h.sale_type IN ('GROWER', 'DEALER')
        AND hs.status_code = 'SI'
        AND h.tracking_id = ts.tracking_id
        AND (   ts.source IN
        ('SRX', 'SRXH', 'SRXF', 'SEEDTRAK', 'KEYED')
        OR (ts.source = 'WS-XML' AND p_ds.acct_id != 168618))
        AND h.ship_date = dd.date_key
        AND EXISTS
        (SELECT 1
        FROM ecg_tran_header h1,
        ecg_tran_header_status hs1,
        ecg_tran_party tp1
        WHERE     h1.tran_id = hs1.tran_id
        AND h1.tran_id = tp1.tran_id
        AND tp1.party_code = 'SF'
        AND hs1.status_code = 'SI'
        AND hs1.status_id IN (3, 5)
        AND hs1.row_modify_date > #startDate#
        AND h1.rptd_doc_nbr = h.rptd_doc_nbr
        AND tp1.acct_id = p_sf.acct_id       )
        AND p_sf.acct_id = cad.acct_id
        AND cad.acct_id = cgp.acct_id
        AND d.prod_id = pps.prod_id
        AND d.prod_id = spd.product_id
        AND cbr.source_system_code = 'IRD'
        AND cbr.BRAND_FAMILY_DESCR = 'NATIONAL'
        AND cad.source_system_code = 'IRD'
        AND cad.BRAND_GROUP_CODE = 'NB'
        AND cgp.customer_grp_code = bt.dest_alias_id
        AND bt.alias_program = 'CDW749RT'
        AND bt.dest_alias_id = #groupCode#
        AND bt.source_alias_type = 'CustGrp'
        AND spd.OWNED_LICENSED_CODE = 'OWNED'
        AND dd.date_key = dpm.date_key
        AND TO_NUMBER (
        LPAD (NVL (h.seedco_sales_rep_code, 0), 12, '0')) =
        salesrep.seedco_salesrep_id(+)
        AND NVL (cgp.mfd_flag, 'N') != 'X'
        AND cgp.distribution_channel_code = '02'
        AND cgp.division_code = '17'
        AND cgp.sales_org_code = 'CJ20'
        AND p_st.acct_id = cbr.source_acct_id
        AND cbr.source_acct_id = gln_map.acct_id(+)
        AND gln_map.system_type_code(+) = 'GLN'
        AND gln_map.RANK(+) = 1
        AND gln_map.active_flag(+) = 'Y'
        AND CASE
        WHEN     spd.specie_code = 'L'
        AND SUBSTR (dpm.period_descr, 1, 4) >= '2006'
        AND SUBSTR (spd.trait_code, 1, 1) = 'W'
        THEN
        'WINTER CANOLA'
        ELSE
        'MARKET YEAR'
        END = dpm.period_type
        AND CASE
        WHEN     spd.specie_code = 'L'
        AND SUBSTR (dpm.period_descr, 1, 4) >= '2006'
        AND SUBSTR (spd.trait_code, 1, 1) = 'W'
        THEN
        0
        WHEN TO_NUMBER (TO_CHAR (SYSDATE, 'MM')) > 8
        THEN
        1
        ELSE
        0
        END = dpm.curr_period_offset)
        GROUP BY rptd_doc_nbr,
        detail_seq_nbr,
        sales_order_type_code,
        data_source,
        invc_date,
        fiscal_year,
        dealer_name,
        dealer_ebid,
        dealer_acct_id,
        dealer_mailing_address,
        dealer_mailing_city,
        dealer_mailing_state,
        dealer_mailing_zip_code,
        dealer_mailing_county,
        grower_name,
        grower_gln,
        grower_acct_id,
        grower_contact_name,
        grower_mailing_address,
        grower_mailing_city,
        grower_mailing_state,
        grower_mailing_zip_code,
        grower_mailing_county,
        upc_code,
        product_name,
        gtin,
        sales_uom,
        equivilent_qty_uom,
        salesrep_name,
        contact_name,
        salesrep_id,
        salesrep_address_1,
        salesrep_city,
        salesrep_state,
        salesrep_zip,
        salesrep_county,
        Touched_Untouched
        ORDER BY
        rptd_doc_nbr,
        dealer_acct_id,
        grower_acct_id
    </select>


    <select id="getGPOSXMLOrders" resultMap="gposWinfield" parameterClass="java.util.Map">
        (
        SELECT
        rptd_doc_nbr,
        detail_seq_nbr,
        sales_order_type_code,
        data_source,
        invc_date,
        fiscal_year,
        dealer_name,
        dealer_ebid,
        dealer_acct_id,
        dealer_mailing_address,
        dealer_mailing_city,
        dealer_mailing_state,
        dealer_mailing_zip_code,
        dealer_mailing_county,
        grower_name,
        grower_gln,
        grower_napd_id,
        grower_acct_id,
        grower_contact_name,
        grower_mailing_address,
        grower_mailing_city,
        grower_mailing_state,
        grower_mailing_zip_code,
        grower_mailing_county,
        upc_code,
        product_name,
        gtin,
        SUM(sales_qty) sales_qty,
        sales_uom,
        SUM(equivalent_qty) equivalent_qty,
        equivilent_qty_uom,
        salesrep_name,
        contact_name,
        salesrep_id,
        salesrep_address_1,
        salesrep_city,
        salesrep_state,
        salesrep_zip,
        salesrep_county,
        Touched_Untouched
        FROM
        (
        SELECT DISTINCT
        h.rptd_doc_nbr,
        h.tran_id,
        d.detail_seq_nbr,
        'NS' sales_order_type_code,
        ts.source data_source,
        dd.day_date invc_date,
        SUBSTR(dd.mkt_yr, 1,4) fiscal_year,
        cbr.name_1 dealer_name,
        x.ic_code dealer_ebid,
        cbr.acct_id dealer_acct_id,
        cbr.shipping_addr_line_1 dealer_mailing_address,
        cbr.shipping_city dealer_mailing_city,
        cbr.shipping_state_code dealer_mailing_state,
        cbr.shipping_zip_code dealer_mailing_zip_code,
        cbr.shipping_county dealer_mailing_county,
        g.name_1 grower_name,
        gln_map.alias_id grower_gln,
        g.napd_id grower_napd_id,
        g.acct_id grower_acct_id,
        g.primary_contact_full_name grower_contact_name,
        g.mailing_addr_line_1 grower_mailing_address,
        g.mailing_city grower_mailing_city,
        g.mailing_state_code grower_mailing_state,
        g.mailing_zip_code grower_mailing_zip_code,
        g.mailing_county grower_mailing_county,
        spd.upc_code upc_code,
        spd.legal_descr_1 product_name,
        pps.upc_scc_code gtin,
        DECODE(hs.status_id,'5','0',d.ssu_qty) sales_qty,
        DECODE(pps.UOM_code, 'BN','BG',pps.UOM_code) sales_uom,
        DECODE(hs.status_id,'5','0',d.ssu_qty) equivalent_qty,
        'UN' equivilent_qty_uom,
        cbr.name_1 salesrep_name,
        salesrep.name_1
        || ' '
        || salesrep.name_3 contact_name,
        salesrep.alias_ss_code salesrep_id,
        cbr.mailing_addr_line_1 salesrep_address_1,
        cbr.mailing_city salesrep_city,
        cbr.mailing_state_code salesrep_state,
        cbr.mailing_zip_code salesrep_zip,
        cbr.mailing_county salesrep_county,
        DECODE (h.man_attn_flag, 'Y', 'N', 'Y') Touched_Untouched
        FROM
        ecg_tran_header h,
        ecg_tran_detail d,
        ecg_tran_party p_sf,
        ecg_tran_party p_st,
        ecg_tran_party p_ds,
        ecg_tracking_source ts,
        ecg_tran_header_status hs,
        d1_active_grower_dim g,
        d1_active_channel_account_dim cad,
        d1_cbr_account_dim cbr,
        d1_active_channel_account_dim x ,
        s_acct_sales_area cgp,
        (
        SELECT
        *
        FROM
        (
        SELECT
        acct_id,
        system_type_code,
        alias_id,
        active_flag,
        rank,
        begin_date,
        MAX(begin_date) over (partition BY acct_id, rank) max_date
        FROM
        s_acct_xref
        WHERE
        system_type_code='GLN'
        AND active_flag   ='Y'
        AND rank          =1
        )
        WHERE
        begin_date = max_date
        )
        gln_map,
        d1_date_dim dd,
        s_seedco_salesrep salesrep,
        d1_seed_product_dim spd,
        s_prod_package_struct pps,
        d1_date_period_map dpm,
        d1_biotech_translation bt
        WHERE
        h.tran_id         = d.tran_id
        AND h.tran_id       = p_sf.tran_id
        AND p_sf.party_code = 'SF'
        AND h.tran_id       = p_st.tran_id
        AND p_st.party_code = 'ST'
        AND h.tran_id       = p_ds.tran_id
        AND p_ds.party_code = 'DS'
        AND h.tracking_id   = ts.tracking_id
        AND h.tran_id       = hs.tran_id
        AND h.ship_date     = TO_CHAR(dd.day_date, 'yyyymmdd')
        AND EXISTS
        (
        SELECT
        1
        FROM
        ecg_tran_header h1,
        ecg_tran_header_status hs1,
        ecg_tran_party tp1
        WHERE
        h1.tran_id                   = hs1.tran_id
        AND h1.tran_id                 = tp1.tran_id
        AND tp1.party_code             = 'SF'
        AND hs1.status_code            = 'SI'
        AND hs1.status_id             IN (3,5)
        AND TO_CHAR(hs1.row_modify_date,'DD-MON-YY') > #startDate#
        AND h1.rptd_doc_nbr            = h.rptd_doc_nbr
        AND tp1.acct_id                = p_sf.acct_id
        )
        AND p_sf.acct_id                                            = cbr.acct_id
        AND cbr.acct_id                                             = cgp.acct_id
        AND d.prod_id                                               = pps.prod_id
        AND d.prod_id                                               = spd.product_id
        and  LTRIM(cad.sap_cust_id,'0') = LTRIM(cbr.cust_id,'0')
        and cbr.acct_id=x.acct_id(+)
        and cbr.source_system_code='IRD' and cbr.BRAND_FAMILY_DESCR='NATIONAL'
        AND cgp.customer_grp_code                                   = bt.dest_alias_id
        AND bt.alias_program                                        ='CDW749RT'
        AND bt.dest_alias_id                                        ='6L'
        AND bt.source_alias_type                                    ='CustGrp'
        AND hs.status_id                                           IN (3,5)
        AND spd.OWNED_LICENSED_CODE                                 = 'OWNED'
        AND hs.status_code                                          ='SI'
        AND dd.date_key                                             = dpm.date_key
        AND to_number(LPAD (NVL (h.seedco_sales_rep_code,0),12,'0'))=TO_NUMBER (
        salesrep.seedco_salesrep_id(+))
        AND NVL (cgp.mfd_flag, 'N')      !='X'
        AND cgp.distribution_channel_code = '02'
        AND cgp.division_code             ='17'
        AND cgp.sales_org_code            ='CJ20'
        AND p_st.acct_id                  = g.acct_id
        AND
        (
        ts.source       = 'XML'
        AND p_ds.acct_id != 168618
        )
        AND g.acct_id                   = gln_map.acct_id(+)
        AND gln_map.system_type_code(+) = 'GLN'
        AND gln_map.rank(+)             = 1
        AND gln_map.active_flag(+)      = 'Y'
        AND
        CASE
        WHEN spd.specie_code                 = 'L'
        AND SUBSTR (dpm.period_descr, 1, 4) >= '2006'
        AND SUBSTR (spd.trait_code, 1, 1)    = 'W'
        THEN 'WINTER CANOLA'
        ELSE 'MARKET YEAR'
        END = dpm.period_type
        AND
        CASE
        WHEN spd.specie_code                 = 'L'
        AND SUBSTR (dpm.period_descr, 1, 4) >= '2006'
        AND SUBSTR (spd.trait_code, 1, 1)    = 'W'
        THEN 0
        WHEN TO_NUMBER(TO_CHAR(SYSDATE, 'MM')) > 8
        THEN 1
        ELSE 0
        END = dpm.curr_period_offset
        )
        GROUP BY
        rptd_doc_nbr,
        detail_seq_nbr,
        sales_order_type_code,
        data_source,
        invc_date,
        fiscal_year,
        dealer_name,
        dealer_ebid,
        dealer_acct_id,
        dealer_mailing_address,
        dealer_mailing_city,
        dealer_mailing_state,
        dealer_mailing_zip_code,
        dealer_mailing_county,
        grower_name,
        grower_gln,
        grower_napd_id,
        grower_acct_id,
        grower_contact_name,
        grower_mailing_address,
        grower_mailing_city,
        grower_mailing_state,
        grower_mailing_zip_code,
        grower_mailing_county,
        upc_code,
        product_name,
        gtin,
        sales_uom,
        equivilent_qty_uom,
        salesrep_name,
        contact_name,
        salesrep_id,
        salesrep_address_1,
        salesrep_city,
        salesrep_state,
        salesrep_zip,
        salesrep_county,
        Touched_Untouched
        UNION ALL
        SELECT
        rptd_doc_nbr,
        detail_seq_nbr,
        sales_order_type_code,
        data_source,
        invc_date,
        fiscal_year,
        dealer_name,
        dealer_ebid,
        dealer_acct_id,
        dealer_mailing_address,
        dealer_mailing_city,
        dealer_mailing_state,
        dealer_mailing_zip_code,
        dealer_mailing_county,
        grower_name,
        grower_gln,
        grower_napd_id,
        grower_acct_id,
        grower_contact_name,
        grower_mailing_address,
        grower_mailing_city,
        grower_mailing_state,
        grower_mailing_zip_code,
        grower_mailing_county,
        upc_code,
        product_name,
        gtin,
        SUM (sales_qty),
        sales_uom,
        SUM (equivalent_qty),
        equivilent_qty_uom,
        salesrep_name,
        contact_name,
        salesrep_id,
        salesrep_address_1,
        salesrep_city,
        salesrep_state,
        salesrep_zip,
        salesrep_county,
        Touched_Untouched
        FROM
        (
        SELECT DISTINCT
        h.rptd_doc_nbr,
        h.tran_id,
        d.detail_seq_nbr,
        'NS' sales_order_type_code,
        ts.source data_source,
        dd.day_date invc_date,
        SUBSTR(dd.mkt_yr, 1,4) fiscal_year,
        cbr.name_1 dealer_name,
        x.ic_code dealer_ebid,
        cbr.acct_id dealer_acct_id,
        cbr.shipping_addr_line_1 dealer_mailing_address,
        cbr.shipping_city dealer_mailing_city,
        cbr.shipping_state_code dealer_mailing_state,
        cbr.shipping_zip_code dealer_mailing_zip_code,
        cbr.shipping_county dealer_mailing_county,
        g.name_1 grower_name,
        gln_map.alias_id grower_gln,
        g.napd_id grower_napd_id,
        g.acct_id grower_acct_id,
        g.primary_contact_full_name grower_contact_name,
        g.mailing_addr_line_1 grower_mailing_address,
        g.mailing_city grower_mailing_city,
        g.mailing_state_code grower_mailing_state,
        g.mailing_zip_code grower_mailing_zip_code,
        g.mailing_county grower_mailing_county,
        spd.upc_code upc_code,
        spd.legal_descr_1 product_name,
        pps.upc_scc_code gtin,
        DECODE(hs.status_id,'5','0',d.ssu_qty) sales_qty,
        DECODE(pps.UOM_code, 'BN','BG',pps.UOM_code) sales_uom,
        DECODE(hs.status_id,'5','0',d.ssu_qty) equivalent_qty,
        'UN' equivilent_qty_uom,
        cbr.name_1 salesrep_name,
        salesrep.name_1
        || ' '
        || salesrep.name_3 contact_name,
        salesrep.alias_ss_code salesrep_id,
        cbr.mailing_addr_line_1 salesrep_address_1,
        cbr.mailing_city salesrep_city,
        cbr.mailing_state_code salesrep_state,
        cbr.mailing_zip_code salesrep_zip,
        cbr.mailing_county salesrep_county,
        DECODE (h.man_attn_flag, 'Y', 'N', 'Y') Touched_Untouched
        FROM
        ecg_tran_header h,
        ecg_tran_detail d,
        ecg_tran_party p_sf,
        ecg_tran_party p_st,
        ecg_tran_party p_ds,
        ecg_tracking_source ts,
        ecg_tran_header_status hs,
        d1_active_grower_dim g,
        d1_active_channel_account_dim cad,
        d1_cbr_account_dim cbr,
        d1_active_channel_account_dim x ,
        s_acct_sales_area cgp,
        (
        SELECT
        *
        FROM
        (
        SELECT
        acct_id,
        system_type_code,
        alias_id,
        active_flag,
        rank,
        begin_date,
        MAX(begin_date) over (partition BY acct_id, rank) max_date
        FROM
        s_acct_xref
        WHERE
        system_type_code='GLN'
        AND active_flag   ='Y'
        AND rank          =1
        )
        WHERE
        begin_date = max_date
        )
        gln_map,
        d1_date_dim dd,
        s_seedco_salesrep salesrep,
        d1_seed_product_dim spd,
        s_prod_package_struct pps,
        d1_date_period_map dpm
        WHERE
        h.tran_id         = d.tran_id
        AND h.tran_id       = p_sf.tran_id
        AND p_sf.party_code = 'SF'
        AND h.tran_id       = p_st.tran_id
        AND p_st.party_code = 'ST'
        AND h.tran_id       = p_ds.tran_id
        AND p_ds.party_code = 'DS'
        AND h.tracking_id   = ts.tracking_id
        AND h.tran_id       = hs.tran_id
        AND h.ship_date     = TO_CHAR(dd.day_date, 'yyyymmdd' )
        AND EXISTS
        (
        SELECT
        1
        FROM
        ecg_tran_header h1,
        ecg_tran_header_status hs1,
        ecg_tran_party tp1
        WHERE
        h1.tran_id                              = hs1.tran_id
        AND h1.tran_id                               = tp1.tran_id
        AND tp1.party_code                           = 'SF'
        AND hs1.status_code                          = 'SI'
        AND hs1.status_id                           IN (3,5)
        AND TO_CHAR(hs1.row_modify_date,'DD-MON-YY')> #startDate#
        AND h1.rptd_doc_nbr                          = h.rptd_doc_nbr
        AND tp1.acct_id                              = p_sf.acct_id
        )
        AND p_sf.acct_id                                            = cbr.acct_id
        AND cbr.acct_id                                             = cgp.acct_id
        AND d.prod_id                                               = pps.prod_id
        AND d.prod_id                                               = spd.product_id
        and  LTRIM(cad.sap_cust_id,'0') = LTRIM(cbr.cust_id,'0')
        and cbr.acct_id=x.acct_id(+)
        and cbr.source_system_code='IRD' and cbr.BRAND_FAMILY_DESCR='NATIONAL'
        AND hs.status_id                                           IN (3,5)
        AND hs.status_code                                          = 'SI'
        AND dd.date_key                                             = dpm.date_key
        AND to_number(LPAD (NVL (h.seedco_sales_rep_code,0),12,'0'))=TO_NUMBER (
        salesrep.seedco_salesrep_id(+))
        AND p_st.acct_id = g.acct_id
        AND
        (
        ts.source      = 'XML'
        AND p_ds.acct_id = 168618
        )
        AND g.acct_id                   = gln_map.acct_id(+)
        AND gln_map.system_type_code(+) = 'GLN'
        AND gln_map.rank(+)             = 1
        AND gln_map.active_flag(+)      = 'Y'
        AND
        CASE
        WHEN spd.specie_code                 = 'L'
        AND SUBSTR (dpm.period_descr, 1, 4) >= '2006'
        AND SUBSTR (spd.trait_code, 1, 1)    = 'W'
        THEN 'WINTER CANOLA'
        ELSE 'MARKET YEAR'
        END = dpm.period_type
        AND
        CASE
        WHEN spd.specie_code                 = 'L'
        AND SUBSTR (dpm.period_descr, 1, 4) >= '2006'
        AND SUBSTR (spd.trait_code, 1, 1)    = 'W'
        THEN 0
        WHEN TO_NUMBER(TO_CHAR(SYSDATE, 'MM')) > 8
        THEN 1
        ELSE 0
        END = dpm.curr_period_offset
        )
        GROUP BY
        rptd_doc_nbr,
        detail_seq_nbr,
        sales_order_type_code,
        data_source,
        invc_date,
        fiscal_year,
        dealer_name,
        dealer_ebid,
        dealer_acct_id,
        dealer_mailing_address,
        dealer_mailing_city,
        dealer_mailing_state,
        dealer_mailing_zip_code,
        dealer_mailing_county,
        grower_name,
        grower_gln,
        grower_napd_id,
        grower_acct_id,
        grower_contact_name,
        grower_mailing_address,
        grower_mailing_city,
        grower_mailing_state,
        grower_mailing_zip_code,
        grower_mailing_county,
        upc_code,
        product_name,
        gtin,
        sales_uom,
        equivilent_qty_uom,
        salesrep_name,
        contact_name,
        salesrep_id,
        salesrep_address_1,
        salesrep_city,
        salesrep_state,
        salesrep_zip,
        salesrep_county,
        Touched_Untouched
        )
        order by rptd_doc_nbr, dealer_acct_id, grower_acct_id
    </select>

    <select id="getGPOSAgrimineOrders" resultMap="gposWinfield" parameterClass="java.util.Map">
        SELECT
        rptd_doc_nbr,
        detail_seq_nbr,
        sales_order_type_code,
        data_source,
        invc_date,
        fiscal_year,
        dealer_name,
        dealer_ebid,
        dealer_acct_id,
        dealer_mailing_address,
        dealer_mailing_city,
        dealer_mailing_state,
        dealer_mailing_zip_code,
        dealer_mailing_county,
        grower_name,
        grower_gln,
        grower_napd_id,
        grower_acct_id,
        grower_contact_name,
        grower_mailing_address,
        grower_mailing_city,
        grower_mailing_state,
        grower_mailing_zip_code,
        grower_mailing_county,
        upc_code,
        product_name,
        gtin,
        SUM (sales_qty) sales_qty,
        sales_uom,
        SUM (equivalent_qty) equivalent_qty,
        equivilent_qty_uom,
        salesrep_name,
        contact_name,
        salesrep_id,
        salesrep_address_1,
        salesrep_city,
        salesrep_state,
        salesrep_zip,
        salesrep_county,
        Touched_Untouched
        FROM
        (
        SELECT DISTINCT
        h.rptd_doc_nbr,
        h.tran_id,
        d.detail_seq_nbr,
        'NS' sales_order_type_code,
        ts.source data_source,
        dd.day_date invc_date,
        SUBSTR(dd.mkt_yr, 1,4) fiscal_year,
        cbr.name_1 dealer_name,
        x.ic_code dealer_ebid,
        cbr.acct_id dealer_acct_id,
        cbr.shipping_addr_line_1 dealer_mailing_address,
        cbr.shipping_city dealer_mailing_city,
        cbr.shipping_state_code dealer_mailing_state,
        cbr.shipping_zip_code dealer_mailing_zip_code,
        cbr.shipping_county dealer_mailing_county,
        g.name_1 grower_name,
        gln_map.alias_id grower_gln,
        g.napd_id grower_napd_id,
        g.acct_id grower_acct_id,
        g.primary_contact_full_name grower_contact_name,
        g.mailing_addr_line_1 grower_mailing_address,
        g.mailing_city grower_mailing_city,
        g.mailing_state_code grower_mailing_state,
        g.mailing_zip_code grower_mailing_zip_code,
        g.mailing_county grower_mailing_county,
        spd.upc_code upc_code,
        spd.legal_descr_1 product_name,
        pps.upc_scc_code gtin,
        DECODE(hs.status_id,'5','0',d.ssu_qty) sales_qty,
        DECODE(pps.UOM_code, 'BN','BG',pps.UOM_code) sales_uom,
        DECODE(hs.status_id,'5','0',d.ssu_qty) equivalent_qty,
        'UN' equivilent_qty_uom,
        cbr.name_1 salesrep_name,
        salesrep.name_1
        || ' '
        || salesrep.name_3 contact_name,
        salesrep.alias_ss_code salesrep_id,
        cbr.mailing_addr_line_1 salesrep_address_1,
        cbr.mailing_city salesrep_city,
        cbr.mailing_state_code salesrep_state,
        cbr.mailing_zip_code salesrep_zip,
        cbr.mailing_county salesrep_county,
        DECODE (h.man_attn_flag, 'Y', 'N', 'Y') Touched_Untouched
        FROM
        ecg_tran_header h,
        ecg_tran_detail d,
        ecg_tran_party p_sf,
        ecg_tran_party p_st,
        ecg_tran_party p_ds,
        ecg_tracking_source ts,
        ecg_tran_header_status hs,
        d1_active_grower_dim g,
        d1_active_channel_account_dim cad,
        d1_cbr_account_dim cbr,
        d1_active_channel_account_dim x ,
        s_acct_sales_area cgp,
        (
        SELECT
        *
        FROM
        (
        SELECT
        acct_id,
        system_type_code,
        alias_id,
        active_flag,
        rank,
        begin_date,
        MAX(begin_date) over (partition BY acct_id, rank) max_date
        FROM
        s_acct_xref
        WHERE
        system_type_code='GLN'
        AND active_flag   ='Y'
        AND rank          =1
        )
        WHERE
        begin_date = max_date
        )
        gln_map,
        d1_date_dim dd,
        s_seedco_salesrep salesrep,
        d1_seed_product_dim spd,
        s_prod_package_struct pps,
        d1_date_period_map dpm
        WHERE
        h.tran_id         = d.tran_id
        AND h.tran_id       = p_sf.tran_id
        AND p_sf.party_code = 'SF'
        AND h.tran_id       = p_st.tran_id
        AND p_st.party_code = 'ST'
        AND h.tran_id       = p_ds.tran_id
        AND p_ds.party_code = 'DS'
        AND h.tracking_id   = ts.tracking_id
        AND h.tran_id       = hs.tran_id
        AND h.ship_date     = TO_CHAR(dd.day_date, 'yyyymmdd')
        AND EXISTS
        (
        SELECT
        1
        FROM
        ecg_tran_header h1,
        ecg_tran_header_status hs1,
        ecg_tran_party tp1
        WHERE
        h1.tran_id                                  = hs1.tran_id
        AND h1.tran_id                                = tp1.tran_id
        AND tp1.party_code                            = 'SF'
        AND hs1.status_code                           = 'SI'
        AND hs1.status_id                            IN ( 3, 5)
        AND TO_CHAR(hs1.row_modify_date,'DD-MON-YY') > #startDate#
        AND h1.rptd_doc_nbr                           = h.rptd_doc_nbr
        AND tp1.acct_id                               = p_sf.acct_id
        )
        AND p_sf.acct_id                                            = cbr.acct_id
        AND cbr.acct_id                                             = cgp.acct_id
        AND d.prod_id                                               = pps.prod_id
        AND d.prod_id                                               = spd.product_id
        and  LTRIM(cad.sap_cust_id,'0') = LTRIM(cbr.cust_id,'0')
        and cbr.acct_id=x.acct_id(+)
        and cbr.source_system_code='IRD' and cbr.BRAND_FAMILY_DESCR='NATIONAL'
        AND hs.status_id                                           IN ( 3, 5)
        AND hs.status_code                                          = 'SI'
        AND dd.date_key                                             = dpm.date_key
        AND to_number(LPAD (NVL (h.seedco_sales_rep_code,0),12,'0'))= TO_NUMBER (
        salesrep.seedco_salesrep_id(+))
        AND p_st.acct_id                = g.acct_id
        AND ts.source                   = 'AGRIMINE'
        AND g.acct_id                   = gln_map.acct_id(+)
        AND gln_map.system_type_code(+) = 'GLN'
        AND gln_map.rank(+)             = 1
        AND gln_map.active_flag(+)      = 'Y'
        AND
        CASE
        WHEN spd.specie_code                 = 'L'
        AND SUBSTR (dpm.period_descr, 1, 4) >= '2006'
        AND SUBSTR (spd.trait_code, 1, 1)    = 'W'
        THEN 'WINTER CANOLA'
        ELSE 'MARKET YEAR'
        END = dpm.period_type
        AND
        CASE
        WHEN spd.specie_code                 = 'L'
        AND SUBSTR (dpm.period_descr, 1, 4) >= '2006'
        AND SUBSTR (spd.trait_code, 1, 1)    = 'W'
        THEN 0
        WHEN TO_NUMBER(TO_CHAR(SYSDATE, 'MM')) > 8
        THEN 1
        ELSE 0
        END = dpm.curr_period_offset
        )
        GROUP BY
        rptd_doc_nbr,
        detail_seq_nbr,
        sales_order_type_code,
        data_source,
        invc_date,
        fiscal_year,
        dealer_name,
        dealer_ebid,
        dealer_acct_id,
        dealer_mailing_address,
        dealer_mailing_city,
        dealer_mailing_state,
        dealer_mailing_zip_code,
        dealer_mailing_county,
        grower_name,
        grower_gln,
        grower_napd_id,
        grower_acct_id,
        grower_contact_name,
        grower_mailing_address,
        grower_mailing_city,
        grower_mailing_state,
        grower_mailing_zip_code,
        grower_mailing_county,
        upc_code,
        product_name,
        gtin,
        sales_uom,
        equivilent_qty_uom,
        salesrep_name,
        contact_name,
        salesrep_id,
        salesrep_address_1,
        salesrep_city,
        salesrep_state,
        salesrep_zip,
        salesrep_county,
        Touched_Untouched
        ORDER BY
        rptd_doc_nbr,
        dealer_acct_id,
        grower_acct_id
    </select>

    <!--CUSTPLT-632 - Introducing new Partner Agdata-->
    <select id="getGPOSAgDataOrders" resultMap="gposWinfieldAgdata" parameterClass="java.util.Map">
        SELECT rptd_doc_nbr,
        detail_seq_nbr,
        sales_order_type_code,
        data_source,
        invc_date,
        fiscal_year,
        dealer_name,
        dealer_ebid,
        dealer_acct_id,
        dealer_mailing_address,
        dealer_mailing_city,
        dealer_mailing_state,
        dealer_mailing_zip_code,
        dealer_mailing_county,
        grower_name,
<!--        grower_gln,-->
        grower_napd_id,
        grower_acct_id,
        grower_contact_name,
        grower_mailing_address,
        grower_mailing_city,
        grower_mailing_state,
        grower_mailing_zip_code,
        grower_mailing_county,
        upc_code,
        SENT_TO_AGDATA,
        reopen,
        product_name,
        TRAN_ID,
<!--        acronym_name,-->
        SAP_MAT_ID,
        gtin,
        SUM (sales_qty) sales_qty,
        sales_uom,
        SUM (equivalent_qty) equivalent_qty,
        equivilent_qty_uom,
        salesrep_name,
        contact_name,
        salesrep_id,
        salesrep_address_1,
        salesrep_city,
        salesrep_state,
        salesrep_zip,
        salesrep_county,
        Touched_Untouched,
<!--        mdm_tech_id,-->
        specie_descr,
        seed_co_brand_descr
        FROM (
        SELECT distinct h.rptd_doc_nbr,
        d.SAP_MAT_ID,
        r.reopen,
        r.SENT_TO_AGDATA,
        h.tran_id,
        d.detail_seq_nbr,
        'NS' sales_order_type_code,
        ts.source data_source,
        dd.day_date invc_date,
        substr(dd.mkt_yr, 1,4) fiscal_year,
        cad.name_1 dealer_name,
        cad.ic_code dealer_ebid,
        cad.acct_id dealer_acct_id,
        cad.shipping_addr_line_1 dealer_mailing_address,
        cad.shipping_city dealer_mailing_city,
        cad.shipping_state_code dealer_mailing_state,
        cad.shipping_zip_code dealer_mailing_zip_code,
        cad.shipping_county dealer_mailing_county,
        g.name_1 grower_name,
<!--        gln_map.alias_id grower_gln,-->
        g.napd_id grower_napd_id,
        g.acct_id grower_acct_id,
        g.primary_contact_full_name grower_contact_name,
        g.mailing_addr_line_1 grower_mailing_address,
        g.mailing_city grower_mailing_city,
        g.mailing_state_code grower_mailing_state,
        g.mailing_zip_code grower_mailing_zip_code,
        g.mailing_county grower_mailing_county,
        spd.upc_code upc_code,
<!--        spd.legal_descr_1 product_name,-->
        spd.acronym_name product_name,
        pps.upc_scc_code gtin,
        d.ssu_qty sales_qty,
        decode(pps.UOM_code, 'BN','BG',pps.UOM_code) sales_uom,
        d.ssu_qty equivalent_qty,
        'UN' equivilent_qty_uom,
        cad.name_1 salesrep_name,
        salesrep.name_1 || ' ' || salesrep.name_3 contact_name,
        salesrep.alias_ss_code salesrep_id,
        cad.mailing_addr_line_1 salesrep_address_1,
        cad.mailing_city salesrep_city,
        cad.mailing_state_code salesrep_state,
        cad.mailing_zip_code salesrep_zip,
        cad.mailing_county salesrep_county,
        decode (h.man_attn_flag, 'Y', 'N', 'Y') Touched_Untouched,
<!--        mdm.MDM_TECH_ID,-->
        spd.specie_descr,
        spd.seed_co_brand_descr
        FROM ecg_tran_header h,
        ecg.tran_hdr_stat_reop r,
        ecg_tran_detail d,
        ecg_tran_party p_sf,
        ecg_tran_party p_st,
        ecg_tran_party p_ds,
        ecg_tracking_source ts,
        ecg_tran_header_status hs,
        <!--dm_active_grower_dim g,
        dm_active_channel_account_dim cad, -->
        d1_ms.active_grower_dim_mv g,
        d1_ms.active_channel_account_dim_mv cad,
        s_acct_sales_area cgp,
<!--        (select *-->
<!--        from (select acct_id, system_type_code,-->
<!--        alias_id, active_flag, rank, begin_date,-->
<!--        max(begin_date) over (partition by acct_id, rank) max_date-->
<!--        from s_acct_xref-->
<!--        where system_type_code='GLN' and active_flag='Y' and rank=1-->
<!--        )-->
<!--        where begin_date = max_date-->
<!--        )gln_map,-->
<!--        (select   acct_id, system_type_code,-->
<!--        alias_id, active_flag, rank, begin_date,-->
<!--        max(begin_date) over (partition by acct_id, rank) max_date-->
<!--        from  s_acct_xref-->
<!--        where  system_type_code='GLN' and active_flag='Y' and rank=1-->
<!--        ) gln_map,-->
        <!-- dm_date_dim dd, -->
        d1_ms.date_dim dd,
        s_seedco_salesrep salesrep,
        <!-- dm_seed_product_dim spd, -->
        d1_seed_product_dim spd,
        s_prod_package_struct pps,
        <!-- dm_date_period_map dpm,
        cdw_dm.CBR_GROWER_DIM mdm -->
        d1_ms.date_period_map dpm
<!--        , d1_CBR_GROWER_DIM mdm-->
        <isNull property="companyCode">
            <!-- ,biotech_translation bt -->
            ,d1_ms.biotech_translation bt
        </isNull>
        WHERE h.tran_id = d.tran_id
        AND r.tran_id = d.tran_id
        AND h.tran_id = p_sf.tran_id
        AND p_sf.party_code = 'SF'
        AND h.tran_id = p_st.tran_id
        AND p_st.party_code = 'ST'
        AND h.tran_id = p_ds.tran_id
        AND p_ds.party_code = 'DS'
        AND h.tracking_id = ts.tracking_id
        AND h.tran_id = hs.tran_id
        AND h.ship_date = to_char(dd.day_date, 'yyyymmdd')
        AND exists (select 1 from ecg_tran_header h1, ecg_tran_header_status hs1, ecg_tran_party tp1
        where h1.tran_id = hs1.tran_id
        and h1.tran_id = tp1.tran_id
        and h1.tran_id = h.tran_id
        and tp1.party_code = 'SF'
<!--        and hs1.status_id = 3-->
        and ((hs1.status_id = 3) AND r.REOPEN='N')
        AND (r.SENT_TO_AGDATA = 'N' OR r.SENT_TO_AGDATA is NULL)
        and hs1.row_modify_date > #startDate#
        AND SUBSTR(dd.mkt_yr, 1,4) >= '2020'
        and h1.rptd_doc_nbr = h.rptd_doc_nbr
        and tp1.acct_id = p_sf.acct_id)
        AND p_sf.acct_id = cad.acct_id
        AND cad.acct_id = cgp.acct_id
        AND d.prod_id = pps.prod_id
        AND d.prod_id = spd.product_id
        <isNull property="companyCode">
            AND cgp.customer_grp_code = bt.dest_alias_id
            AND bt.alias_program = 'CDW749RT'
            AND bt.source_alias_type = 'CustGrp'
        </isNull>
<!--        AND hs.status_id = 3-->
        AND ((hs.status_id = 3) AND r.REOPEN='N')
        <isNull property="companyCode">
            AND spd.OWNED_LICENSED_CODE = 'OWNED'
        </isNull>
        AND dd.date_key = dpm.date_key
        AND to_number(LPAD (NVL (h.seedco_sales_rep_code,0),12,'0'))=TO_NUMBER (salesrep.seedco_salesrep_id(+))
        AND NVL (cgp.mfd_flag, 'N') != 'X'
        <isNull property="companyCode">
            <!-- Changes for JIRA-3745 (US20->CJ20), 90->02 -->
            AND cgp.distribution_channel_code = '02'
            AND cgp.division_code = '17'
            AND cgp.sales_org_code = 'CJ20'
        </isNull>
        AND p_st.acct_id = g.acct_id
<!--        AND g.acct_id = gln_map.acct_id(+)-->
<!--        AND g.grower_key  = mdm.grower_key-->
        AND spd.SEED_BRAND_DESCR in ('ASGROW','DEKALB','DELTA PINE')
        AND spd.SPECIE_DESCR IN ('CANOLA','CORN','COTTON','SORGHUM','SOYBEAN' )
        AND spd.product_class_descr NOT IN ('NOT APPLICABLE','INVALID','TO BE DETERMINE')
<!--        AND mdm.SOURCE_SYSTEM_CODE in ('IRD','ECC-CB','ECC-RB')-->
<!--        AND mdm.BRAND_FAMILY_DESCR = 'NATIONAL'-->
<!--        AND gln_map.alias_id IS NOT NULL-->
        AND H.SALE_TYPE='GROWER'
<!--        AND gln_map.system_type_code(+) = 'GLN'-->
<!--        AND gln_map.rank(+) = 1-->
<!--        AND gln_map.active_flag(+) = 'Y'-->
        and cad.source_system_code = 'IRD'
        )
        group by rptd_doc_nbr,
        detail_seq_nbr,
        sales_order_type_code,
        data_source,
        invc_date,
        fiscal_year,
        dealer_name,
        dealer_ebid,
        dealer_acct_id,
        dealer_mailing_address,
        dealer_mailing_city,
        dealer_mailing_state,
        dealer_mailing_zip_code,
        dealer_mailing_county,
        grower_name,
<!--        grower_gln,-->
        grower_napd_id,
        grower_acct_id,
        grower_contact_name,
        grower_mailing_address,
        grower_mailing_city,
        grower_mailing_state,
        grower_mailing_zip_code,
        grower_mailing_county,
        upc_code,
        SENT_TO_AGDATA,
        reopen,
        product_name,
        TRAN_ID,
<!--        acronym_name,-->
        SAP_MAT_ID,
        gtin,
        sales_uom,
        equivilent_qty_uom,
        salesrep_name,
        contact_name,
        salesrep_id,
        salesrep_address_1,
        salesrep_city,
        salesrep_state,
        salesrep_zip,
        salesrep_county,
        Touched_Untouched,
<!--        mdm_tech_id,-->
        specie_descr,
        seed_co_brand_descr
        order by rptd_doc_nbr, dealer_acct_id, grower_acct_id
    </select>

    <!--OTT 92172 - Seed GPOS Interface to Agdata for Bayer  - Introducing new Partner Agdata2021-->
    <select id="getGPOSAgDataOrders2021" resultMap="gposWinfieldAgdata2021" parameterClass="java.util.Map">
        SELECT rptd_doc_nbr,
        detail_seq_nbr,
        sales_order_type_code,
        data_source,
        invc_date,
        fiscal_year,
        dealer_name,
        dealer_ebid,
        dealer_acct_id,
        dealer_mailing_address,
        dealer_mailing_city,
        dealer_mailing_state,
        dealer_mailing_zip_code,
        dealer_mailing_county,
        grower_name,
<!--        grower_gln,-->
        grower_napd_id,
        grower_acct_id,
        grower_contact_name,
        grower_mailing_address,
        grower_mailing_city,
        grower_mailing_state,
        grower_mailing_zip_code,
        grower_mailing_county,
        upc_code,
        SENT_TO_AGDATA,
        reopen,
        product_name,
        TRAN_ID,
<!--        acronym_name,-->
        SAP_MAT_ID,
        gtin,
        SUM (sales_qty) sales_qty,
        sales_uom,
        SUM (equivalent_qty) equivalent_qty,
        equivilent_qty_uom,
        salesrep_name,
        contact_name,
        salesrep_id,
        salesrep_address_1,
        salesrep_city,
        salesrep_state,
        salesrep_zip,
        salesrep_county,
        Touched_Untouched,
<!--        mdm_tech_id,-->
        specie_descr,
        seed_co_brand_descr
        FROM (
        SELECT distinct h.rptd_doc_nbr,
        d.SAP_MAT_ID,
        r.reopen,
        r.SENT_TO_AGDATA,
        h.tran_id,
        d.detail_seq_nbr,
        'NS' sales_order_type_code,
        ts.source data_source,
        dd.day_date invc_date,
        substr(dd.mkt_yr, 1,4) fiscal_year,
        cad.name_1 dealer_name,
        cad.ic_code dealer_ebid,
        cad.acct_id dealer_acct_id,
        cad.shipping_addr_line_1 dealer_mailing_address,
        cad.shipping_city dealer_mailing_city,
        cad.shipping_state_code dealer_mailing_state,
        cad.shipping_zip_code dealer_mailing_zip_code,
        cad.shipping_county dealer_mailing_county,
        g.name_1 grower_name,
<!--        gln_map.alias_id grower_gln,-->
        g.napd_id grower_napd_id,
        g.acct_id grower_acct_id,
        g.primary_contact_full_name grower_contact_name,
        g.mailing_addr_line_1 grower_mailing_address,
        g.mailing_city grower_mailing_city,
        g.mailing_state_code grower_mailing_state,
        g.mailing_zip_code grower_mailing_zip_code,
        g.mailing_county grower_mailing_county,
        spd.upc_code upc_code,
<!--        spd.legal_descr_1 product_name,-->
        spd.acronym_name product_name,
        pps.upc_scc_code gtin,
        d.ssu_qty sales_qty,
        decode(pps.UOM_code, 'BN','BG',pps.UOM_code) sales_uom,
        d.ssu_qty equivalent_qty,
        'UN' equivilent_qty_uom,
        cad.name_1 salesrep_name,
        salesrep.name_1 || ' ' || salesrep.name_3 contact_name,
        salesrep.alias_ss_code salesrep_id,
        cad.mailing_addr_line_1 salesrep_address_1,
        cad.mailing_city salesrep_city,
        cad.mailing_state_code salesrep_state,
        cad.mailing_zip_code salesrep_zip,
        cad.mailing_county salesrep_county,
        decode (h.man_attn_flag, 'Y', 'N', 'Y') Touched_Untouched,
<!--        mdm.MDM_TECH_ID,-->
        spd.specie_descr,
        spd.seed_co_brand_descr
        FROM ecg_tran_header h,
        ecg.tran_hdr_stat_reop r,
        ecg_tran_detail d,
        ecg_tran_party p_sf,
        ecg_tran_party p_st,
        ecg_tran_party p_ds,
        ecg_tracking_source ts,
        ecg_tran_header_status hs,
        <!--dm_active_grower_dim g,
        dm_active_channel_account_dim cad, -->
        d1_ms.active_grower_dim_mv g,
        d1_ms.active_channel_account_dim_mv cad,
        s_acct_sales_area cgp,
<!--        (select *-->
<!--        from (select acct_id, system_type_code,-->
<!--        alias_id, active_flag, rank, begin_date,-->
<!--        max(begin_date) over (partition by acct_id, rank) max_date-->
<!--        from s_acct_xref-->
<!--        where system_type_code='GLN' and active_flag='Y' and rank=1-->
<!--        )-->
<!--        where begin_date = max_date-->
<!--        )gln_map,-->
<!--        (select   acct_id, system_type_code,-->
<!--        alias_id, active_flag, rank, begin_date,-->
<!--        max(begin_date) over (partition by acct_id, rank) max_date-->
<!--        from  s_acct_xref-->
<!--        where  system_type_code='GLN' and active_flag='Y' and rank=1-->
<!--        ) gln_map,-->
        <!-- dm_date_dim dd, -->
        d1_ms.date_dim dd,
        s_seedco_salesrep salesrep,
        <!-- dm_seed_product_dim spd, -->
        d1_seed_product_dim spd,
        s_prod_package_struct pps,
        <!-- dm_date_period_map dpm,
        cdw_dm.CBR_GROWER_DIM mdm -->
        d1_ms.date_period_map dpm
<!--        , d1_CBR_GROWER_DIM mdm-->
        <isNull property="companyCode">
            <!-- ,biotech_translation bt -->
            ,d1_ms.biotech_translation bt
        </isNull>
        WHERE h.tran_id = d.tran_id
        AND r.tran_id = d.tran_id
        AND h.tran_id = p_sf.tran_id
        AND p_sf.party_code = 'SF'
        AND h.tran_id = p_st.tran_id
        AND p_st.party_code = 'ST'
        AND h.tran_id = p_ds.tran_id
        AND p_ds.party_code = 'DS'
        AND h.tracking_id = ts.tracking_id
        AND h.tran_id = hs.tran_id
        AND h.ship_date = to_char(dd.day_date, 'yyyymmdd')
        AND exists (select 1 from ecg_tran_header h1, ecg_tran_header_status hs1, ecg_tran_party tp1
        where h1.tran_id = hs1.tran_id
        and h1.tran_id = tp1.tran_id
        and h1.tran_id = h.tran_id
        and tp1.party_code = 'SF'
        AND ((hs1.status_id = 3 OR hs1.status_id = 5) AND r.REOPEN='Y')
        AND (r.SENT_TO_AGDATA = 'N' OR r.SENT_TO_AGDATA is NULL)
        and hs1.row_modify_date > #startDate#
        AND SUBSTR(dd.mkt_yr, 1,4) >= '2020'
        and h1.rptd_doc_nbr = h.rptd_doc_nbr
        and tp1.acct_id = p_sf.acct_id)
        AND p_sf.acct_id = cad.acct_id
        AND cad.acct_id = cgp.acct_id
        AND d.prod_id = pps.prod_id
        AND d.prod_id = spd.product_id
        <isNull property="companyCode">
            AND cgp.customer_grp_code = bt.dest_alias_id
            AND bt.alias_program = 'CDW749RT'
            AND bt.source_alias_type = 'CustGrp'
        </isNull>
        AND ((hs.status_id = 3 OR hs.status_id = 5) AND r.REOPEN='Y')
        AND (r.SENT_TO_AGDATA = 'N' OR r.SENT_TO_AGDATA is NULL)
        <isNull property="companyCode">
            AND spd.OWNED_LICENSED_CODE = 'OWNED'
        </isNull>
        AND dd.date_key = dpm.date_key
        AND to_number(LPAD (NVL (h.seedco_sales_rep_code,0),12,'0'))=TO_NUMBER (salesrep.seedco_salesrep_id(+))
        AND NVL (cgp.mfd_flag, 'N') != 'X'
        <isNull property="companyCode">
            <!-- Changes for JIRA-3745 (US20->CJ20), 90->02 -->
            AND cgp.distribution_channel_code = '02'
            AND cgp.division_code = '17'
            AND cgp.sales_org_code = 'CJ20'
        </isNull>
        AND p_st.acct_id = g.acct_id
<!--        AND g.acct_id = gln_map.acct_id(+)-->
<!--        AND g.grower_key  = mdm.grower_key-->
        AND spd.SEED_BRAND_DESCR in ('ASGROW','DEKALB','DELTA PINE')
        AND spd.SPECIE_DESCR IN ('CANOLA','CORN','COTTON','SORGHUM','SOYBEAN' )
        AND spd.product_class_descr NOT IN ('NOT APPLICABLE','INVALID','TO BE DETERMINE')
<!--        AND mdm.SOURCE_SYSTEM_CODE in ('IRD','ECC-CB','ECC-RB')-->
<!--        AND mdm.BRAND_FAMILY_DESCR = 'NATIONAL'-->
<!--        AND gln_map.alias_id IS NOT NULL-->
        AND H.SALE_TYPE='GROWER'
<!--        AND gln_map.system_type_code(+) = 'GLN'-->
<!--        AND gln_map.rank(+) = 1-->
<!--        AND gln_map.active_flag(+) = 'Y'-->
        and cad.source_system_code = 'IRD'
        )
        group by rptd_doc_nbr,
        detail_seq_nbr,
        sales_order_type_code,
        data_source,
        invc_date,
        fiscal_year,
        dealer_name,
        dealer_ebid,
        dealer_acct_id,
        dealer_mailing_address,
        dealer_mailing_city,
        dealer_mailing_state,
        dealer_mailing_zip_code,
        dealer_mailing_county,
        grower_name,
<!--        grower_gln,-->
        grower_napd_id,
        grower_acct_id,
        grower_contact_name,
        grower_mailing_address,
        grower_mailing_city,
        grower_mailing_state,
        grower_mailing_zip_code,
        grower_mailing_county,
        upc_code,
        SENT_TO_AGDATA,
        reopen,
        product_name,
        TRAN_ID,
<!--        acronym_name,-->
        SAP_MAT_ID,
        gtin,
        sales_uom,
        equivilent_qty_uom,
        salesrep_name,
        contact_name,
        salesrep_id,
        salesrep_address_1,
        salesrep_city,
        salesrep_state,
        salesrep_zip,
        salesrep_county,
        Touched_Untouched,
<!--        mdm_tech_id,-->
        specie_descr,
        seed_co_brand_descr
        order by rptd_doc_nbr, dealer_acct_id, grower_acct_id
    </select>

</sqlMap>